<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>五子棋</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="description" content="五子棋"/>
    <meta name="robots" content="index,follow"/>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="五子棋">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <link rel="stylesheet" type="text/css" href="../../css/reset.css">
    <style type="text/css">
		#container {
            width: 600px;
            height: 600px;
			margin:0 auto;
            margin-top: 50px;
			background:url(wu.png) no-repeat;
			padding-top:7px;
			padding-left:8px;
		}

		table{
			border-collapse:collapse;
			width:525px;
			height:525px;
		}
		td.black{
			background: url('black.gif');
		}
		td.white{
			background: url('white.gif');
		}
		@media screen and(max-width: 980px){
			.container{

			}
		}
		@media screen and (max-width:480px){
			.container{
				width:400px;
				height:400px;
			}
			table{
				width: 400px;
				height: 400px;
			}
		}
		@media screen and (max-width:360px){
			.container{
				width:100%;
				height:auto;
			}
			table{
				width: 100%;
				height: auto;
			}
		}
    </style>
</head>
<body>
	<div id="container">
            <table>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
            </table>
        </div>
    <script type="text/javascript">
// 1:展示棋盘
// 2:点击能下棋(变色,变背景图)
// 3:每次下棋前要判断胜负
// 4:如果胜负已定,则不允许下棋
// 5:如果该td已经有棋子,也不允许

function Qi() {
    var tag = 'black';
    var winner = false; // 是否已判定胜负

 	// 初始化坐标
 	var tdAll = document.getElementsByTagName('td');
 	var xlength = document.getElementsByTagName('tr').length;
 	var ylength = document.getElementsByTagName('tr')[0].getElementsByTagName('td').length;
 	var qiarray = [];
 	var trs = document.getElementsByTagName('tr');
 	var tds = '';
 	for (var i = 0; i < trs.length; i++) {
 		tds = trs[i].getElementsByTagName('td');
 		qiarray[i] = [];
 		for(var j = 0; j < tds.length; j++){
 			tds[j].x = j;
 			tds[j].y = i;
 			tds[j].qi = 0;
 			qiarray[i][j] = tds[j];
 		}
 	};

 	// 转置
 	for (var i = 0; i < ylength; i++) {
 		for(var j = i + 1; j < xlength; j++ ){
 			var t = qiarray[i][j];
 			qiarray[i][j] = qiarray[j][i];
 			qiarray[j][i] = t;
 		}
 	};

 	console.dir(qiarray);
    document.getElementsByTagName('table')[0].onclick = function (ev) {
        ev = ev || window.event;
        //alert('hello');
        var tar = ev.srcElement || ev.target;
        //alert(tar.num);

        xia.call(tar);
    }

    // 下棋动作
    var xia = function () {
        // 判断 棋局是否已结束
        if(winner) {
            if(confirm('输咯!重试一下')){
            	reset();
            };
            return;
        }
        if(this.nodeName != 'TD'){
        	return;
        }
        // 判断,当前格子是否已经有棋子
        if(this.className){
        	console.log('此处已经有棋子');
        	return;
        }
        this.className = tag;

        this.qi = tag == 'black' ? 'b' : 'w';  // 给格子做标记
        tag = tag == 'black' ? 'white' : 'black';  // 交换棋权
        // 判断胜负
        judge.call(this);
        
    }

    // 判断胜负功能
    var judge = function () {
    	var obj = {
    		x: this.x,
    		y: this.y,
    		qi: this.qi
    	};
        console.log(obj);
        if(win.call(this)){
        	winner = this.qi == 'b' ? 'black' : 'white' ;
        	alert(winner + '获胜');
        }else{
        	console.log(winner);
        }
    }
    var win = function(){
    	var obj = {
    		x: this.x,
    		y: this.y,
    		qi: this.qi
    	};
    	var x = this.x;
    	var y = this.y;
    	var qiTag = this.qi;

    	var length = 0;
    	// 水平方向
		var lenxr = findXR(x-1, y, qiTag, 0);
		var lenxl = findXL(x+1, y, qiTag, 0);
		if(lenxr + lenxl >= 4){
			console.log(lenxr,lenxl);
			return true;
		}
    	// 垂直方向
    	debugger;
		var lenyt = findYT(x, y-1, qiTag, 0);
		var lenyb = findYB(x, y+1, qiTag, 0);
		if(lenyt + lenyb >= 4){
			console.log(lenyt, lenyb);
			return true;
		}
    	
    	// 右斜方向

    	var lenrt = findRT(x+1, y-1, qiTag, 0);
    	var lenlb = findLB(x-1, y+1, qiTag, 0);
    	if(lenyt + lenlb >= 4){
    		return true;
    	}
    	// 左斜方向
    	var lenlt = findLT(x-1, y-1, qiTag, 0);
    	var lenrb = findRB(x+1, y+1, qiTag, 0);
    	if(lenlt + lenrb >= 4){
    		return true;
    	}

    }

    var findXR = function(x, y, tag, length){
    	if(x<0){
    		return length;
    	}
    	var ar = qiarray[x][y];
    	if(ar.qi == tag){
    		length ++;
    		return findXR(x-1, y, tag, length);
    	}else{
    		return length;
    	}
    }

    var findXL = function(x, y, tag, length){
    	if(x>= xlength){
    		return length;
    	}
    	var ar = qiarray[x][y];
    	if(ar.qi == tag){
    		length ++;
    		return findXL(x+1, y, tag, length);
    	}else{
    		return length;
    	}
    }


	var findYT = function(x, y, tag, length){
    	if(y<0){
    		return length;
    	}
    	var ar = qiarray[x][y];
    	if(ar.qi == tag){
    		length ++;
    		return findYT(x, y-1, tag, length);
    	}else{
    		return length;
    	}
    }

    var findYB = function(x, y, tag, length){
    	if(y>= ylength){
    		return length;
    	}
    	var ar = qiarray[x][y];
    	if(ar.qi == tag){
    		length ++;
    		return findYB(x, y+1, tag, length);
    	}else{
    		return length;
    	}
    }

    // 右上
    var findRT = function(x, y, tag, length){
    	if(x >= xlength || y < 0){
    		return length;
    	}
    	var ar = qiarray[x][y];
    	if(ar.qi == tag){
    		length ++;
    		return findRT(x + 1, y - 1, tag, length);
    	}else{
    		return length;
    	}
    } 
    // 左下
    var findLB = function(x, y, tag, length){
    	if(x < 0 || y >= ylength){
    		return length;
    	}
    	var ar = qiarray[x][y];
    	if(ar.qi == tag){
    		length ++;
    		return findLB(x - 1, y + 1, tag, length);
    	}else{
    		return length;
    	}
    }

    // 左上
    var findLT = function(x, y, tag, length){
    	if(x < 0 || y < 0){
    		return length;
    	}
    	var ar = qiarray[x][y];
    	if(ar.qi == tag){
    		length ++;
    		return findLT(x - 1, y - 1, tag, length);
    	}else{
    		return length;
    	}
    }
    // 右下
    var findRB = function(x, y, tag, length){
    	if(x >= xlength || y >= ylength){
    		return length;
    	}
    	var ar = qiarray[x][y];
    	if(ar.qi == tag){
    		length ++;
    		return findRB(x + 1, y + 1, tag, length);
    	}else{
    		return length;
    	}
    }

    var search = function(){
    	var next = [];

    }

    var searchLine = function(){

    }

    var reset = function(){
    	winner = false;
    	tag = 'black';
    	for(var i=0,tds = document.getElementsByTagName('td'),l=tds.length; i<l;i++) {
	        tds[i].className = '';
	        tds[i].qi = 0;// 下黑棋后,qi属性变为b, 下白棋后,qi属性为w
	    }
    }

}

window.onload = function () {
    new Qi();
}
//http://blog.csdn.net/liuaigui/article/details/2228050
    </script>
</body>
</html>