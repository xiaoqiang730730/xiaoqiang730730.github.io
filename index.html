<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="Keywords" content="blog"/>
    <meta name="Description" content="blog"/>
    <title>Simple</title>
    <link rel="shortcut icon" href="favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="main.css" />
    <style type="text/css" media="screen">
        html, body{
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        a{
            color: #4094c7;
            -webkit-transition: all 0.2s linear;
            -moz-transition: all 0.2s linear;
            -ms-transition: all 0.2s linear;
            transition: all 0.2s linear;
        }
        a:hover, .title a:hover{
            border-bottom: 1px solid #4094c7;

        }
        .header{
            margin: 0;
            width: auto;
            float: none;
        }
        .date{
            font-size: 16px;
        }
        .header ul{
            width: 500px;
            text-align: left;
        }
        .header li{
            display: inline-block;
            margin: 0;
            padding: 10px;
            height: 22px;
            line-height: 22px;
        }
        .header a{
            font-size: 16px;
            color: #007498;
        }
        .header a:hover{
            border: 0px;
            text-shadow: #585858 0px 0px 3px;
        }
        .container{
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            width: 100%;
            height: 100%;
        }
        .left{
            -webkit-box-flex: 1;
            -webkit-flex: 1;
              -ms-flex: 1;
                  flex: 1;
          -webkit-box-align: center;
          -webkit-align-items: center;
              -ms-flex-align: center;
                  align-items: center;
          -webkit-box-pack: center;
          -webkit-justify-content: center;
              -ms-flex-pack: center;
                  justify-content: center;
            text-align:center;
            /*background-image: url('http://upload.jianshu.io/daily_images/images/wgjtysyZYzsJVPCGzDBE.jpg');*/
        }
        .item{
            margin: 0;
        }
        .right{
            -webkit-box-flex: 2;
            -webkit-flex: 2;
              -ms-flex: 2;
                  flex: 2;
        }
        .right .main{
            width: auto;
        }

        .left img{
            width: 100px;
            height: 100px;
            border-radius: 50%;
            -webkit-transition: all 1.2s linear;
            -moz-transition: all 1.2s linear;
            -ms-transition: all 1.2s linear;
            transition: all 1.2s linear;
        }
        .left img:hover{
            transform: rotateY(360deg);
            box-shadow: 0 0 5px 5px rgba(0, 255, 57, 0.66);
        }
        .J_view_img:hover{
            border: 0;
        }
        .J_view_link{
            position: relative;
        }
        .J_view_link a{
            display: inline-block;
            width: 30px;
            height: 30px;
            background-size: cover;
            cursor: pointer;
        }
        .J_view_link a:hover{
            border: 0;
        }
        .J_view_weibo{
            background-image: url('weibo.png');
        }
        .J_view_github{
            background-image: url('github.png');
        }
        .J_view_weixin{
            background-image: url('weixin.png');
        }
        .J_view_mail{
            background-image: url('email.png');
        }
        .J_view_link .J_view_weixin:hover ~ .J_view_weixin2{
            opacity: 1;
            top: 40px;
            right: 30%;
        }
        .J_view_link .J_view_weixin2{
            position: absolute;
            opacity: 0;
            top: 40px;
            right: -10px;
            width: 200px;
            height: 200px;
            background-image: url('erweima.png');
        }
        .left p{
            line-height: 20px;
            font-size: 14px;
            color: #8B8B8B;
            padding: 10px 80px;
            text-align: left;
            text-indent: 2rem;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="left">
        <div style="margin-top:100px;">
            <a class="J_view_img" href="http://weibo.com/smallwall520" target="_blank"><img src="http://tp3.sinaimg.cn/2631626602/180/5734058041/1" alt=""></a>
        </div>
        <div style="margin-top: 5px;">
            <a href="http://weibo.com/smallwall520" target="_blank">前端-小强</a>
        </div>
        <div style="margin-top: 10px;" class="J_view_link">
            <a class="J_view_weibo" href="http://weibo.com/smallwall520" target="_blank"></a>
            <a class="J_view_github" href="https://github.com/xiaoqiang730730" target="_blank"></a>
            <a class="J_view_weixin"></a>
            <a class="J_view_mail" href="mailto:838871837@qq.com" target="_blank" title="有内推职位"></a>
            <a class="J_view_weixin2"></a>
        </div>
        <div>
            <p>
                我是一名前端工程师，就职一家充满活力的<abbr title="杭州关云科技有限公司(有内推职位)"><a href="http://www.raycloud.com/" target="_blank">创业公司</a></abbr>。
                <br/>
                学过后端，搞过数据库，但是现在<a href="/article/choseFrontEnd.html">选择在前端圈里航行！</a>任重道远！加油！↖(^ω^)↗
            </p>
        </div>
    </div>
    <div class="right">
        <div class="main">
            <div class="wrap-header">
                <h1>
                    <a href="http://weibo.com/smallwall520" target="_blank" id="title"></a>
                </h1>
            </div>
            <div class="header">
                <ul id="pages">
                    <li>
                        <a href="/">主页</a>
                    </li>
                    <li>
                        <a href="/#/tags">标签</a>
                    </li>
                    <li>
                        <a href="/#/archive">存档</a>
                    </li>
                </ul>
            </div>
            <div class="innermain" id="main"></div>
            <div class="footer">
                <p>© Copyright 2016 by <a href="http://weibo.com/smallwall520" target="_blank">前端-小强</a></p>
            </div>
        </div>
    </div>
</div>
<script src="main.js"></script>
<script id="itemTemplate" type="text/mustache">
    {{#posts}}
    <div class="item">
        <div class="date">
            {{date}}
        </div>
        <div class="title">
            <h2>
                <a href="{{path}}">{{title}}</a>
            </h2>
        </div>
    </div>
    {{/posts}}
    <ul class="pages">
        Pages:
        {{#pages}}
            <li>
            {{#select}}
                <span class="selected">{{num}}</span>
            {{/select}}
            {{^select}}
                <a href="{{path}}">{{num}}</a>
            {{/select}}
            </li>
        {{/pages}}
    </ul>
</script>
<script id="archiveTemplate" type="text/mustache">
    {{#group}}
    {{name}}
    {{#posts}}
    <div class="archive">
    <span>{{date}}</span>
    <a href="{{path}}">{{title}}</a>
    </div>
    {{/posts}}
    {{/group}}
</script>
<script id="pagesTemplate" type="text/mustache">
    {{#pages}}
    <li>
        <a href="{{path}}">{{title}}</a>
    </li>
    {{/pages}}
</script>
<script id="tagsTemplate" type="text/mustache">
    <ul style="list-style: none">
        {{#tags}}
        <li style="display:inline; margin: 15px;">
            <a href="{{path}}">{{name}}</a>
        </li>
        {{/tags}}
    </ul>
</script>
<script>
$(document).ready(function() {
    $.ajax({
        url: "main.json",
        type: "GET",
        dataType: "json",
        success: function(data) {
            $("#title").html(data.name);
            data.posts.sort(function(a, b){
                if (a.date > b.date)
                    return -1;
                if (a.date < b.date)
                    return 1;
                return 0;
            });
            console.log(data.posts);
            var per = data.number_of_posts_per_page;
            var n = data.posts.length;
            var num = Math.floor((n-1)/per)+1;
            var arr = [];
            var tmp = [];
            for (var i = 0; i < n; ++i) {
                if (i != 0 && i % per == 0) {
                    arr.push(tmp)
                    tmp = [];
                }
                tmp.push(data.posts[i]);
            }
            if (tmp.length > 0)
                arr.push(tmp);
            var pages = [{"select": true, "num": 1, "path": "#/page/1"}];
            for (var i = 1; i < num; ++i)
                pages.push({"select": false, "num": i+1, "path": "#/page/"+(i+1)});
            var itemTemplate = Hogan.compile($("#itemTemplate").html());
            var itemHtml = itemTemplate.render({"posts": arr[0], "pages": pages});
            $("#main").html(itemHtml);
            var pagesTemplate = Hogan.compile($("#pagesTemplate").html());
            var pagesHtml = pagesTemplate.render({"pages": data.pages});
            $("#pages").append(pagesHtml);
            var App = Spine.Controller.sub({
                el: $("#main"),
                init: function() {
                    this.routes({
                        "/page/:page": function(page) {this.go(page);},
                        "/tags": function() {this.tags();},
                        "/tag/:tag": function(param) {this.tag(param);},
                        "/archive": function() {this.archive();}
                    });
                    Spine.Route.setup();
                },
                go: function(page) {
                    page = Math.floor(page.page);
                    for (var i = 0; i < pages.length; ++i)
                        pages[i].select = false;
                    pages[page-1].select = true;
                    var tmppages = pages;
                    if (page > 2 && pages.length > 4)
                        tmppages = pages.slice(page-3);
                    if (tmppages.length > 5)
                        tmppages = tmppages.slice(0, 5);
                    if (pages.length > 4 && tmppages.length < 5)
                        tmppages = pages.slice(-5);
                    itemHtml = itemTemplate.render({"posts": arr[page-1], "pages": tmppages});
                    $("#main").html(itemHtml);
                },
                tags: function() {
                    var ts = {};
                    var posts = data.posts;
                    var tf = function() {
                        for (var i = 0; i < posts.length; ++i) {
                            var tmp = posts[i].tags.split(" ");
                            for (var j = 0; j < tmp.length; ++j) {
                                if (tmp[j].length == 0)
                                    continue;
                                if (!(tmp[j] in ts))
                                    ts[tmp[j]] = 0;
                                ts[tmp[j]]++;
                            }
                        }
                    }
                    tf();
                    posts = data.pages;
                    tf();
                    var ans = [];
                    for (var k in ts) {
                        ans.push({"name": "#"+k, "size": 100+Math.sqrt(ts[k]-1)*30, "path": "#/tag/"+k});
                    }
                    var tagsTemplate = Hogan.compile($("#tagsTemplate").html());
                    var tagsHtml = tagsTemplate.render({"tags": ans});
                    $("#main").html(tagsHtml);
                },
                tag: function(param) {
                    var tag = param.tag;
                    var group = [{"name": "#"+tag}];
                    var posts = [];
                    for (var i = 0; i < data.posts.length; ++i) {
                        var tmp = data.posts[i].tags.split(" ");
                        if (tmp.indexOf(tag) != -1)
                            posts.push(data.posts[i]);
                    }
                    for (var i = 0; i < data.pages.length; ++i) {
                        var tmp = data.pages[i].tags.split(" ");
                        if (tmp.indexOf(tag) != -1)
                            posts.push(data.pages[i]);
                    }
                    group[0].posts = posts;
                    var tmpTemplate = Hogan.compile($("#archiveTemplate").html());
                    var tmpHtml = tmpTemplate.render({"group": group});
                    $("#main").html(tmpHtml);
                },
                archive: function() {
                    var group = [];
                    var posts = data.posts;
                    var now = -1;
                    var name = "";
                    for (var i = 0; i < posts.length; ++i) {
                        if (name != posts[i].date.slice(0,4)) {
                            name = posts[i].date.slice(0,4);
                            group.push({"name": name, "posts": []});
                            now++;
                        }
                        group[now].posts.push(posts[i]);
                    }
                    var tmpTemplate = Hogan.compile($("#archiveTemplate").html());
                    var tmpHtml = tmpTemplate.render({"group": group});
                    $("#main").html(tmpHtml);
                }
            });
            new App();
        },
        error: function(e) {
            console.log("init error");
        }
    });    
});
</script>
</body>
</html>
